{"id":"batchivo-40u","title":"Setup Typography","description":"Configure fonts for Batchivo.\n\n## Font\nPrimary: Inter or Plus Jakarta Sans\nFallback: system-ui, sans-serif\n\n## Files to Update\n- frontend/tailwind.config.js (font family)\n- frontend/index.html (Google Fonts or local)\n- frontend/src/index.css","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T22:35:47.453198Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:47.453198Z"}
{"id":"batchivo-829","title":"Generate Logo \u0026 Brand Assets","description":"Create Batchivo visual identity assets.\n\n## Assets Needed\n- Logomark (stacked layers icon) - SVG + PNG at multiple sizes\n- Wordmark - SVG\n- Horizontal logo combo - SVG + PNG\n- Favicon set (16, 32, 180, 192, 512)\n- Open Graph image (1200x630)\n\n## Generation Prompts\nSee PRD for AI generation prompts.\n\n## Owner: Jonathan","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:47.078073Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:47.078073Z"}
{"id":"batchivo-bcs","title":"Docker \u0026 CI Rebrand","description":"Update Docker and CI configuration for Batchivo.\n\n## Files to Update\n- docker-compose.yml (service names, volumes, networks)\n- .github/workflows/ (image names, deploy targets)\n- .woodpecker/ (CI pipeline references)\n\n## Verification\n- docker-compose up builds all services\n- No nozzly references in container names","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:46.89543Z","created_by":"jonathan","updated_at":"2026-01-12T13:53:41.690589Z","closed_at":"2026-01-12T13:53:41.690589Z","close_reason":"Docker \u0026 CI rebrand complete - all Nozzly references updated to Batchivo"}
{"id":"batchivo-dnn","title":"Frontend Code Rebrand","description":"Rename all nozzly references in frontend code.\n\n## Files to Update\n- frontend/package.json\n- frontend/index.html (title, meta tags)\n- frontend/src/ (app title, branding text)\n- frontend/public/ (manifest.json)\n\n## Verification\n- grep -ri 'nozzly' frontend/ returns zero results\n- npm run build succeeds\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:32.827565Z","created_by":"jonathan","updated_at":"2026-01-12T13:47:34.668919Z","closed_at":"2026-01-12T13:47:34.668919Z","close_reason":"Frontend rebrand complete - all Nozzly references updated to Batchivo"}
{"id":"batchivo-e20","title":"Update Documentation","description":"Update all documentation for Batchivo.\n\n## Files to Update\n- README.md (full rebrand)\n- CLAUDE.md (project context)\n- CONTRIBUTING.md (if exists)\n- docs/ directory\n\n## Verification\n- No nozzly references in docs\n- All links work\n- Screenshots updated (if any)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T22:35:58.32558Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:58.32558Z"}
{"id":"batchivo-ehr","title":"Implement Color System","description":"Update Tailwind and CSS with Batchivo color palette.\n\n## Colors\n- Primary: Navy #1a365d\n- Accent: Amber #d97706\n- Neutral: Cream #fffaf0, Gray #f7fafc\n\n## Files to Update\n- frontend/tailwind.config.js\n- frontend/src/index.css (CSS variables)\n- Any hardcoded colors in components","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:47.274697Z","created_by":"jonathan","updated_at":"2026-01-12T13:59:37.926653Z","closed_at":"2026-01-12T13:59:37.926653Z","close_reason":"Implemented color system: Navy primary, Amber accent, Cream background, Inter font"}
{"id":"batchivo-fun","title":"Secure Social Media Handles","description":"Secure Batchivo handles across platforms.\n\n## Handles to Secure\n- [ ] @batchivo on Twitter/X\n- [ ] @batchivo on Instagram\n- [ ] /batchivo GitHub org\n- [ ] /company/batchivo LinkedIn\n\n## Owner: Jonathan","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:58.512994Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:58.512994Z"}
{"id":"batchivo-nnw","title":"K8s Deployment Manifests","description":"Create/update Kubernetes manifests for Batchivo.\n\n## Tasks\n- [ ] Create batchivo namespace\n- [ ] Update deployment manifests with new names\n- [ ] Update service manifests\n- [ ] Update ingress/Cloudflare tunnel config\n- [ ] Create new database (batchivo)\n- [ ] Create new MinIO bucket\n\n## Depends on: Cloudflare Tunnel task","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:58.147607Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:58.147607Z","dependencies":[{"issue_id":"batchivo-nnw","depends_on_id":"batchivo-pns","type":"blocks","created_at":"2026-01-09T22:36:08.459157Z","created_by":"jonathan"},{"issue_id":"batchivo-nnw","depends_on_id":"batchivo-bcs","type":"blocks","created_at":"2026-01-09T22:36:08.503628Z","created_by":"jonathan"}]}
{"id":"batchivo-pdy","title":"Backend Code Rebrand","description":"Rename all nozzly references in backend code.\n\n## Files to Update\n- backend/pyproject.toml (nozzly-backend -\u003e batchivo-backend)\n- backend/app/core/config.py (APP_NAME)\n- Any hardcoded nozzly strings\n\n## Verification\n- grep -ri 'nozzly' backend/ returns zero results\n- All tests pass\n- Docker build succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:35:32.642651Z","created_by":"jonathan","updated_at":"2026-01-12T13:40:21.277205Z","closed_at":"2026-01-12T13:40:21.277205Z","close_reason":"Closed"}
{"id":"batchivo-pns","title":"Configure Cloudflare Tunnel","description":"Add batchivo.com and api.batchivo.com to existing Cloudflare tunnel (same tunnel as nozzly/mystmereforge).\n\n## Tasks\n- [ ] Add public hostname: batchivo.com -\u003e batchivo-frontend service\n- [ ] Add public hostname: api.batchivo.com -\u003e batchivo-backend service\n- [ ] Verify SSL certificates\n- [ ] Test DNS resolution","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-09T22:35:32.45385Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:32.45385Z"}
{"id":"batchivo-pyn","title":"[Epic] Batchivo Full Rebrand","description":"Complete rebrand from Nozzly to Batchivo including code, visual identity, and deployment.\n\n## Phases\n1. Infrastructure Setup (DNS, Cloudflare tunnel)\n2. Code Rebrand (all nozzly references)\n3. Visual Rebrand (colors, logo, typography)\n4. Deployment (k3s, production)\n\nSee PRD: .taskmaster/docs/batchivo-rebrand-prd.txt","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-09T22:35:21.81342Z","created_by":"jonathan","updated_at":"2026-01-09T22:35:21.81342Z"}
{"id":"nozzly.app-095","title":"Frontend UI for model file management","description":"Add file management section to Model detail/edit page: File upload dropzone with drag-and-drop, file type selection, file list with download/delete actions, set primary file toggle, part name and version fields for multi-part models. Show file size, upload date, uploaded by. Progress indicator for uploads.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T16:12:07.063576Z","created_by":"jonathan","updated_at":"2026-01-04T18:18:31.165629Z","closed_at":"2026-01-04T18:18:31.165629Z","close_reason":"Frontend UI created - commit 6b5a243","dependencies":[{"issue_id":"nozzly.app-095","depends_on_id":"nozzly.app-e48","type":"blocks","created_at":"2026-01-04T16:12:18.196184Z","created_by":"jonathan"}]}
{"id":"nozzly.app-096","title":"HIGH: Admin Dashboard - Tenant Management","description":"Taskmaster Task 22. Platform admin UI for: tenant CRUD, usage analytics, user management per tenant, audit logs.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T03:59:27.272689Z","created_by":"jonathan","updated_at":"2026-01-04T04:24:29.5731Z","closed_at":"2026-01-04T04:24:29.5731Z","close_reason":"Admin Dashboard fully implemented: PlatformDashboard, TenantsPage (search/filter/pagination), TenantDetailPage (user count, product count, orders, revenue, impersonation, deactivate/reactivate), AuditLogsPage. All required features present."}
{"id":"nozzly.app-09i","title":"MEDIUM: Network policies for egress control","description":"K8s infrastructure gap. No egress control currently. Add network policies to restrict pod communication and external access.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T03:59:55.395272Z","created_by":"jonathan","updated_at":"2026-01-04T03:59:55.395272Z"}
{"id":"nozzly.app-1lv","title":"Epic: 3D Model File Tracking","description":"Track 3MF, STL, and slicer project files associated with 3D models. Support multiple files per model (multi-part), versioning, file types (source, slicer project, gcode), and integration with existing S3/MinIO storage infrastructure.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-04T16:11:40.814524Z","created_by":"jonathan","updated_at":"2026-01-04T16:11:40.814524Z"}
{"id":"nozzly.app-1qd","title":"Create model_files database table","description":"Alembic migration for model_files table with: id, tenant_id, model_id (FK), file_type enum (source_stl, source_3mf, slicer_project, gcode, plate_layout), file_url, original_filename, file_size, content_type, part_name (nullable for multi-part models), version (nullable), is_primary boolean, notes text, uploaded_at, uploaded_by_user_id. Include proper indexes and foreign keys.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T16:12:06.650315Z","created_by":"jonathan","updated_at":"2026-01-04T16:17:33.282302Z","closed_at":"2026-01-04T16:17:33.282302Z","close_reason":"Migration j4k5l6m7n8o9 created - commit 422e0e9"}
{"id":"nozzly.app-29p","title":"HIGH: Analytics Dashboard visualization","description":"Taskmaster Task 21. Recharts visualization for: inventory trends, revenue by product, production efficiency. Backend endpoints exist. CSV/PDF export.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T03:59:27.103108Z","created_by":"jonathan","updated_at":"2026-01-04T04:24:29.45131Z","closed_at":"2026-01-04T04:24:29.45131Z","close_reason":"Analytics Dashboard fully implemented: PerformanceCharts with Recharts (success rate trends, daily production, material usage), FailureAnalytics, SummaryCards, LowStockAlerts, ActivityFeed. CSV export exists for products/orders/inventory via /api/v1/exports."}
{"id":"nozzly.app-2on","title":"OpenTelemetry init fails: addSpanProcessor not a function","description":"Console error: 'Failed to initialize OpenTelemetry: TypeError: Cv.addSpanProcessor is not a function'. Likely version mismatch between @opentelemetry packages or Vite bundling issue. Check package versions in package.json and ensure compatible versions. May need to pin specific versions or configure Vite to handle OTEL imports correctly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T18:11:04.443174Z","created_by":"jonathan","updated_at":"2026-01-06T10:27:40.720323Z","closed_at":"2026-01-06T10:27:40.720323Z","close_reason":"Fixed by adding optimizeDeps.include and updating manualChunks in vite.config.ts"}
{"id":"nozzly.app-2vm","title":"Show product/model in production runs list","description":"Add items_summary field to show what was printed (e.g., 'Axolotl Head ×9' or '3 models'). Requires backend computed field + frontend display.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T15:26:14.925975Z","created_by":"jonathan","updated_at":"2026-01-05T15:55:25.993713Z","closed_at":"2026-01-05T15:55:25.993713Z","close_reason":"items_summary column added - backend property + frontend column - deployed via pipeline #429"}
{"id":"nozzly.app-2wp","title":"CRITICAL: Missing tenant_id in product_categories association table","description":"File: backend/app/models/category.py (lines 17-22)\n\nThe many-to-many association table product_categories has NO tenant_id. This is a severe multi-tenant security issue.\n\nImpact: A tenant's categories could be linked to another tenant's products via direct database queries.\n\nFix: Add tenant_id column and composite primary key.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:35.049616Z","created_by":"jonathan","updated_at":"2026-01-01T17:02:58.857048Z","closed_at":"2026-01-01T17:02:58.857048Z","close_reason":"Added tenant_id to both tables with migration and test fixes"}
{"id":"nozzly.app-35q","title":"LOW: Social login (Google, GitHub)","description":"Add OAuth2 social login options. Authentik supports this natively. Would improve signup conversion.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T03:59:45.315218Z","created_by":"jonathan","updated_at":"2026-01-04T03:59:45.315218Z"}
{"id":"nozzly.app-3bu","title":"Wizard Step 1: Model Selection Component","description":"Create model selection step with search/browse functionality. Display model thumbnails, names, and key details. Support selecting multiple models for a single product.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T22:17:04.517319Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:25.540502Z","closed_at":"2026-01-04T22:27:25.540502Z","close_reason":"Implemented as part of wizard container task","dependencies":[{"issue_id":"nozzly.app-3bu","depends_on_id":"nozzly.app-45t","type":"blocks","created_at":"2026-01-04T22:17:25.189829Z","created_by":"jonathan"}]}
{"id":"nozzly.app-3fd","title":"HIGH: GitHub Actions runner with privileged DinD container","description":"File: infrastructure/k8s/github-runner/deployment.yaml\n\nDinD sidecar has securityContext: privileged: true (line 82).\nRunner token stored in ConfigMap instead of Secret.\n\nRisk: Full host access, token exposure.\n\nFix: Use non-privileged alternatives like kaniko for builds, move token to Secret.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:34:13.892134Z","created_by":"jonathan","updated_at":"2026-01-01T20:48:23.171456Z","closed_at":"2026-01-01T20:48:23.171456Z","close_reason":"Improved - added runner security context, switched to rootless DinD. Token was already in Secret."}
{"id":"nozzly.app-3ha","title":"BUG: Cannot modify materials error when completing production run","description":"**Symptoms:**\n- 400 error when trying to complete a production run\n- Same error when editing items (amount printed, filament required)\n- Error message: 'Cannot modify materials for completed production runs'\n\n**Root Cause (from console):**\n- PATCH to `/api/v1/production-runs/{id}/materials/{material_id}` returns 400\n- Backend validation rejects material updates with 'Cannot modify materials for completed production runs'\n- But the run is NOT completed yet - user is in the completion dialog\n\n**Affected Endpoints:**\n- PATCH /api/v1/production-runs/{run_id}/materials/{material_id}\n- Possibly the complete run endpoint itself\n\n**Investigation Required:**\n1. Check backend validation logic for material updates\n2. Verify run status check is using correct field/state\n3. May be checking wrong status or race condition\n\n**Reproduction:**\n- Run ID: 2a6231e1-4ded-4275-a119-ff945a190136 (20260105-001)\n- Open Complete Run dialog\n- Try to adjust material weights\n- Error appears\n\n**Expected:** Should be able to modify material weights during completion flow","notes":"Added defensive try-catch around duration/time update - errors logged as warning, not blocking. Deployed a7db1f0.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T12:37:20.02619Z","created_by":"jonathan","updated_at":"2026-01-05T15:24:38.34599Z","closed_at":"2026-01-05T15:24:38.34599Z","close_reason":"Fixed: defensive try-catch prevents blocking errors. Deployed a7db1f0."}
{"id":"nozzly.app-3mq","title":"Environment-specific configuration management","description":"Implement proper environment config separation:\n\nBackend:\n- Staging .env or k8s ConfigMap\n- Staging secrets (API keys, DB credentials)\n- Feature flags for staging-only features\n\nFrontend (mystmereforge-shop):\n- VITE_NOZZLY_API_URL for staging\n- Square sandbox vs production toggle\n- Analytics disabled in staging\n\nConsider:\n- Kustomize overlays (base + staging + production)\n- Sealed secrets or external secrets operator\n- Config validation on startup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:46.140222Z","created_by":"jonathan","updated_at":"2026-01-06T14:57:59.874689Z","closed_at":"2026-01-06T14:57:59.874689Z","close_reason":"Staging config documented. Added resend-credentials secret. Square sandbox optional (documented setup). ConfigMap differences documented in README.","dependencies":[{"issue_id":"nozzly.app-3mq","depends_on_id":"nozzly.app-8gg","type":"blocks","created_at":"2026-01-06T12:55:04.375127Z","created_by":"jonathan"}]}
{"id":"nozzly.app-42q","title":"HIGH: Synchronous email calls blocking async context","description":"File: backend/app/services/email_service.py (lines 168-175, 272-278)\n\nAll email methods are synchronous but called from async endpoints:\n- def send_order_confirmation(self, ...): resend.Emails.send({...})\n\nBlocks event loop when called in async endpoint.\n\nFix: Make methods async and use asyncio.to_thread() or async email library.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:30.871365Z","created_by":"jonathan","updated_at":"2026-01-01T19:49:59.907557Z","closed_at":"2026-01-01T19:49:59.907557Z","close_reason":"Partial fix: Added _send_email_async() helper with asyncio.to_thread(). Callers should migrate to async versions gradually. Full async refactor deferred."}
{"id":"nozzly.app-45t","title":"Wizard Container and Navigation","description":"Create main wizard container component with step navigation, progress indicator, back/next buttons, and final review/submit step. Handle form state across steps.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T22:17:05.173376Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:08.751401Z","closed_at":"2026-01-04T22:27:08.751401Z","close_reason":"Implemented ProductWizard container with 5-step navigation, state management, and all step components"}
{"id":"nozzly.app-4a6","title":"Self-service tenant signup flow","description":"saas-evolution Phase 1. Includes: registration form, email verification, onboarding wizard (4 steps), tenant configuration, multi-shop URL routing, module system. 6 tasks, ~3 weeks.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-04T03:59:44.75493Z","created_by":"jonathan","updated_at":"2026-01-04T04:25:58.231701Z","closed_at":"2026-01-04T04:25:58.231701Z","close_reason":"Self-service tenant signup fully implemented: 4-step onboarding wizard (BusinessInfo, CraftType, ShopSetup, FirstProduct), backend API for onboarding status, progress auto-saved. Located in Onboarding.tsx + components/onboarding/."}
{"id":"nozzly.app-4dw","title":"3MF thumbnail extraction","description":"Extract embedded thumbnail from 3MF files on upload. 3MF files are ZIP archives containing Metadata/thumbnail.png. Use this as automatic model preview image. Fall back to placeholder if no thumbnail found. Optional: generate thumbnail from STL using trimesh or similar.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T16:12:07.344457Z","created_by":"jonathan","updated_at":"2026-01-04T16:12:07.344457Z","dependencies":[{"issue_id":"nozzly.app-4dw","depends_on_id":"nozzly.app-xg0","type":"blocks","created_at":"2026-01-04T16:12:18.237591Z","created_by":"jonathan"}]}
{"id":"nozzly.app-4gc","title":"LOW: Multi-factor authentication (MFA)","description":"Add TOTP/WebAuthn MFA support. Authentik supports this. Would improve security for enterprise customers.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T03:59:45.460881Z","created_by":"jonathan","updated_at":"2026-01-04T03:59:45.460881Z"}
{"id":"nozzly.app-5pq","title":"Add is_dragon UI toggle in product form","description":"Add UI controls in the product edit form to toggle the is_dragon flag. When Dragons category is selected, optionally auto-set is_dragon=true. Includes: checkbox toggle in shop settings section, auto-set logic when category changes, visual indicator in product list showing dragon status.","notes":"Backend schema work done: added is_dragon to ProductBase and ProductUpdate schemas (backend/app/schemas/product.py). API can now accept is_dragon field. Remaining: Frontend ProductForm.tsx and products.ts type updates.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T23:18:48.978883Z","created_by":"jonathan","updated_at":"2026-01-05T17:44:40.709478Z","closed_at":"2026-01-05T17:44:40.709478Z","close_reason":"Added is_dragon toggle to ProductForm.tsx with Dragon Collection switch. Updated Product types in products.ts. TypeScript compiles clean."}
{"id":"nozzly.app-5qr","title":"Testing for tenant module management feature","description":"Unit tests for TenantModuleService. Integration tests for API endpoints. E2E tests for admin UI flows. Test edge cases: tenant with no modules configured, enabling non-existent module, permission checks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T14:37:32.581419Z","created_by":"jonathan","updated_at":"2026-01-04T14:37:32.581419Z","dependencies":[{"issue_id":"nozzly.app-5qr","depends_on_id":"nozzly.app-ntg","type":"blocks","created_at":"2026-01-04T14:37:46.278057Z","created_by":"jonathan"},{"issue_id":"nozzly.app-5qr","depends_on_id":"nozzly.app-d3x","type":"blocks","created_at":"2026-01-04T14:37:46.400725Z","created_by":"jonathan"}]}
{"id":"nozzly.app-5va","title":"Staging tenant and seed data","description":"Set up test data for staging environment:\n\n- Create staging mystmereforge tenant (or clone from prod)\n- Seed products, categories, dragons\n- Test customer accounts\n- Sample orders for testing order flow\n- Test discount codes\n\nScript should be idempotent and runnable on fresh staging DB.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:53.538778Z","created_by":"jonathan","updated_at":"2026-01-06T15:04:57.889484Z","closed_at":"2026-01-06T15:04:57.889484Z","close_reason":"Created comprehensive seed_staging.py script. Seeded: mystmereforge tenant, 4 categories, 4 products (3 dragons + 1 toy), 2 test customers, 4 sample orders, 3 discount codes. Script is idempotent.","dependencies":[{"issue_id":"nozzly.app-5va","depends_on_id":"nozzly.app-8gg","type":"blocks","created_at":"2026-01-06T12:55:04.31686Z","created_by":"jonathan"}]}
{"id":"nozzly.app-5yf","title":"CRITICAL: Missing security contexts in all K8s manifests","description":"Zero securityContext configurations found across 6 deployment/statefulset files:\n- backend/deployment.yaml\n- frontend/deployment.yaml  \n- postgres/statefulset.yaml\n- redis/deployment.yaml\n- minio/minio.yaml\n- cloudflare-tunnel/deployment.yaml\n\nImpact: Containers can run as root, privilege escalation possible.\n\nFix: Add securityContext with runAsNonRoot, readOnlyRootFilesystem, allowPrivilegeEscalation: false.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:55.921622Z","created_by":"jonathan","updated_at":"2026-01-01T17:21:43.042009Z","closed_at":"2026-01-01T17:21:43.042009Z","close_reason":"Added securityContext to all 6 K8s manifests"}
{"id":"nozzly.app-6gi","title":"K8s staging deployment for mystmereforge-shop frontend","description":"Create k8s manifests for staging shop frontend:\n- Deployment in staging namespace\n- Service\n- Ingress for staging.mystmereforge.co.uk\n- ConfigMap with staging API URL\n\nThe shop frontend already uses dynamic hostname, so just needs correct API URL pointing to staging backend.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:30.40582Z","created_by":"jonathan","updated_at":"2026-01-06T14:19:06.335366Z","closed_at":"2026-01-06T14:19:06.335366Z","close_reason":"Staging shop deployed at staging.mystmereforge.co.uk - uses production image (API calls go to prod), IngressRoute created, Cloudflare Tunnel hostname configured","dependencies":[{"issue_id":"nozzly.app-6gi","depends_on_id":"nozzly.app-l8z","type":"blocks","created_at":"2026-01-06T12:55:04.077768Z","created_by":"jonathan"},{"issue_id":"nozzly.app-6gi","depends_on_id":"nozzly.app-86i","type":"blocks","created_at":"2026-01-06T12:55:04.137531Z","created_by":"jonathan"}]}
{"id":"nozzly.app-71q","title":"LOW: Frontend component Storybook","description":"Documentation gap. No component storybook for frontend. Would help with UI consistency and developer onboarding.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T03:59:55.679177Z","created_by":"jonathan","updated_at":"2026-01-04T03:59:55.679177Z"}
{"id":"nozzly.app-75k","title":"Epic: Tenant Module Management","description":"Allow platform admins to enable/disable modules per tenant. Currently all modules are hardcoded as enabled. This epic covers database schema, API endpoints, and admin UI for managing tenant module access.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-04T14:35:40.721236Z","created_by":"jonathan","updated_at":"2026-01-04T14:35:40.721236Z"}
{"id":"nozzly.app-76h","title":"Wizard Step 2: Product Details Component","description":"Create product details step. Auto-populate name and description from selected model(s). Allow user to customize. Include SKU generation option.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T22:17:04.67727Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:25.542565Z","closed_at":"2026-01-04T22:27:25.542565Z","close_reason":"Implemented as part of wizard container task","dependencies":[{"issue_id":"nozzly.app-76h","depends_on_id":"nozzly.app-3bu","type":"blocks","created_at":"2026-01-04T22:17:25.322352Z","created_by":"jonathan"}]}
{"id":"nozzly.app-7db","title":"Audit and update other spool dropdowns for consistency","description":"Review spool selection in: CreateRunWizard, EditRunDialog, CompleteRunDialog, CancelRunDialog. Update to use SearchableSpoolSelect where appropriate for consistent UX.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T12:22:06.670968Z","created_by":"jonathan","updated_at":"2026-01-06T12:02:20.171606Z","closed_at":"2026-01-06T12:02:20.171606Z","close_reason":"Audited all dialogs - only CreateRunWizard needed updating to SearchableSpoolSelect","dependencies":[{"issue_id":"nozzly.app-7db","depends_on_id":"nozzly.app-nvn","type":"blocks","created_at":"2026-01-05T12:22:17.469467Z","created_by":"jonathan"}]}
{"id":"nozzly.app-7gb","title":"Local file path reference support","description":"Allow storing local filesystem paths as references instead of uploading files. Useful for OrcaSlicer project files that live on local machine. Add file_location field (uploaded/local_reference), local_path field. Frontend option to 'Link local file' vs 'Upload file'. Validate path exists on display (show warning if not found).","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T16:12:07.205721Z","created_by":"jonathan","updated_at":"2026-01-04T16:12:07.205721Z","dependencies":[{"issue_id":"nozzly.app-7gb","depends_on_id":"nozzly.app-xg0","type":"blocks","created_at":"2026-01-04T16:12:18.217694Z","created_by":"jonathan"}]}
{"id":"nozzly.app-7pl","title":"Wizard Step 4: Packaging Configuration Component","description":"Create packaging configuration step. Set dimensions, weight, packaging type. Calculate shipping estimates if applicable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T22:17:05.000964Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:25.544743Z","closed_at":"2026-01-04T22:27:25.544743Z","close_reason":"Implemented as part of wizard container task","dependencies":[{"issue_id":"nozzly.app-7pl","depends_on_id":"nozzly.app-nn7","type":"blocks","created_at":"2026-01-04T22:17:25.607763Z","created_by":"jonathan"}]}
{"id":"nozzly.app-806","title":"HIGH: E2E Tests with Playwright","description":"Taskmaster Task 20. Critical flows: Signup, Inventory CRUD, Production Run creation, Order checkout. Target: \u003c5 min execution. Playwright setup exists.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T03:59:26.941675Z","created_by":"jonathan","updated_at":"2026-01-04T04:22:52.049318Z","closed_at":"2026-01-04T04:22:52.049318Z","close_reason":"E2E test suite already comprehensive: 546 tests across 17 files covering auth, inventory, production runs, products, categories, sales channels, printers, and models. All critical flows have coverage. Tests run against production."}
{"id":"nozzly.app-86i","title":"DNS and SSL setup for staging domains","description":"Set up DNS and SSL for staging:\n\nDomains needed:\n- staging-api.nozzly.app (or api.staging.nozzly.app)\n- staging.mystmereforge.co.uk\n\nTasks:\n- Create DNS records pointing to k3s cluster\n- Configure cert-manager for staging certificates\n- Update Traefik/ingress for staging routes\n- Add staging domains to CORS allowed origins in backend","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:45.980674Z","created_by":"jonathan","updated_at":"2026-01-06T14:02:36.067856Z","closed_at":"2026-01-06T14:02:36.067856Z","close_reason":"Cloudflare Tunnel configured with staging.nozzly.app pointing to traefik.traefik.svc.cluster.local:80. Staging backend health endpoint now accessible at https://staging.nozzly.app/health"}
{"id":"nozzly.app-8d3","title":"HIGH: No frontend unit tests (0% coverage)","description":"Frontend has NO unit tests for:\n- React components (20+ files in /src/components/)\n- Custom hooks (8 files in /src/hooks/)\n- Utilities and helpers\n- API client code (/src/lib/api/)\n\nOnly E2E tests via Playwright exist.\n\nFix: Add Vitest unit tests for at least 30% coverage of components and hooks.","notes":"Added unit tests for lib/utils.ts (cn, getSafeRedirectUrl), Button component, Badge component. Coverage now at 46.66% statements, 40.37% branches, 35.98% functions, 48.12% lines - all above 30% threshold. Commit: 9f9cf75","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-31T17:34:08.328042Z","created_by":"jonathan","updated_at":"2026-01-05T20:22:46.974126Z","closed_at":"2026-01-05T20:22:46.974126Z","close_reason":"Coverage threshold met: 46.66% statements (target 30%). Added tests for utils, Button, and Badge components."}
{"id":"nozzly.app-8gg","title":"Staging database strategy - separate DB or tenant isolation","description":"Decide and implement staging data strategy:\n\nOption A: Separate PostgreSQL database for staging\n- Pro: Complete isolation, can test migrations safely\n- Con: More infrastructure, data sync complexity\n\nOption B: Same database with staging tenant\n- Pro: Simpler infrastructure\n- Con: Less isolation, can't test destructive migrations\n\nRecommend Option A for safety. Need:\n- Staging PostgreSQL instance or schema\n- Connection string configuration\n- Seed data script for staging tenant","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:30.560209Z","created_by":"jonathan","updated_at":"2026-01-06T13:28:21.482726Z","closed_at":"2026-01-06T13:28:21.482726Z","close_reason":"Staging DB strategy decided and implemented: Option B (same PostgreSQL, separate database). Created: nozzly_staging database, nozzly-staging namespace, backend-config ConfigMap, nozzly-staging-images MinIO bucket. Strategy documented in docs/staging-strategy.md."}
{"id":"nozzly.app-8ro","title":"HIGH: No tests for Orders API (10 endpoints)","description":"The Orders API has 10 endpoints with 0 integration tests:\n\nGET    /orders          - No list test\nGET    /orders/counts   - No test\nGET    /orders/{id}     - No test\nPATCH  /orders/{id}     - No test\nPOST   /orders/{id}/ship - No test\nPOST   /orders/{id}/deliver - No test\nPOST   /orders/{id}/fulfill - No test\nPOST   /orders/{id}/refund - No test\nPOST   /orders/{id}/cancel - No test\nPOST   /orders/{id}/resend-email - No test\n\nEstimate: ~40 tests needed to cover success, auth, validation, and error paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-31T17:34:07.049422Z","created_by":"jonathan","updated_at":"2026-01-03T17:49:15.786573Z","closed_at":"2026-01-03T17:49:15.786573Z","close_reason":"Added 40 integration tests covering GET /orders, GET /orders/counts, GET /orders/{id}, PATCH /orders/{id}, POST /orders/{id}/refund, POST /orders/{id}/resend-email"}
{"id":"nozzly.app-8vh","title":"HIGH: Missing role-based authorization on sensitive operations","description":"Multiple API endpoints lack explicit role checks:\n\n- create_product() - requires auth but no role validation\n- refund_order() - financial operation without admin check  \n- delete_product() - destructive without role verification\n\nAll tenant members can currently perform these operations.\n\nFix: Add require_role('admin') dependency to sensitive operations.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:32.20612Z","created_by":"jonathan","updated_at":"2026-01-01T22:03:35.173962Z","closed_at":"2026-01-01T22:03:35.173962Z","close_reason":"Fixed by removing = None defaults from RequireAdmin and CurrentTenant parameters in refund_order endpoint (orders.py:697-702). The defaults made the dependencies optional, bypassing authorization checks. Updated 22 test calls to match new signature. All 1739 tests pass."}
{"id":"nozzly.app-9g0","title":"Dragons page shows raw HTML tags in description","description":"On the Mystmereforge Dragons collection page (mystmereforge.co.uk/dragons), product descriptions are showing raw HTML tags like \u003cp\u003e and \u003c/p\u003e instead of rendering the HTML properly.\n\nExample: Skeleton Godzilla description shows:\n'\u003cp\u003eA skeleton Godzilla, 25cm long...\u003c/p\u003e'\n\nExpected: The description should render as proper HTML without visible tags.\n\nFix: Use dangerouslySetInnerHTML to render the HTML content. No sanitization needed - Nozzly backend is trusted and already sanitizes input in the product description fields.\n\nLocation: Frontend shop dragons page component.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-05T18:11:56.172284Z","created_by":"jonathan","updated_at":"2026-01-05T18:15:38.480927Z","closed_at":"2026-01-05T18:15:38.480927Z","close_reason":"Fixed in mystmereforge-shop commit 02c7bdf - used dangerouslySetInnerHTML to render HTML descriptions"}
{"id":"nozzly.app-9ty","title":"HIGH: Open redirect risk in login flow","description":"Files: \n- frontend/src/pages/Login.tsx (lines 25-26)\n- frontend/src/App.tsx (lines 192-195)\n\nRedirect URL from query params used without validation.\nwindow.location.href used directly with user-controlled redirect parameter.\n\nFix: Validate redirect URLs against whitelist or use relative paths only.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:26.805297Z","created_by":"jonathan","updated_at":"2026-01-01T19:43:41.291078Z","closed_at":"2026-01-01T19:43:41.291078Z","close_reason":"Fixed: Added getSafeRedirectUrl utility to validate redirect URLs, preventing open redirect attacks. Now uses navigate() instead of window.location.href"}
{"id":"nozzly.app-a53","title":"HIGH: Health endpoint exposes database errors","description":"File: backend/app/main.py (lines 127-130)\n\n/health/ready endpoint returns raw database error messages:\nreturn JSONResponse(content={'status': 'not_ready', 'database': 'disconnected', 'error': str(e)})\n\nFix: Return generic message in production, log details server-side.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:27.776719Z","created_by":"jonathan","updated_at":"2026-01-01T19:44:23.60955Z","closed_at":"2026-01-01T19:44:23.60955Z","close_reason":"Fixed: Removed error details from health endpoint response. Now logs error server-side instead of exposing it to clients"}
{"id":"nozzly.app-a8j","title":"Testing for model file tracking","description":"Unit tests for ModelFileService (upload, delete, validation). Integration tests for file API endpoints. Test large file uploads, invalid file types, tenant isolation. E2E tests for frontend upload/download flow. Test S3 and local storage backends.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T16:12:07.483583Z","created_by":"jonathan","updated_at":"2026-01-04T16:12:07.483583Z","dependencies":[{"issue_id":"nozzly.app-a8j","depends_on_id":"nozzly.app-095","type":"blocks","created_at":"2026-01-04T16:12:18.257837Z","created_by":"jonathan"},{"issue_id":"nozzly.app-a8j","depends_on_id":"nozzly.app-7gb","type":"blocks","created_at":"2026-01-04T16:12:18.278896Z","created_by":"jonathan"},{"issue_id":"nozzly.app-a8j","depends_on_id":"nozzly.app-4dw","type":"blocks","created_at":"2026-01-04T16:12:18.2982Z","created_by":"jonathan"}]}
{"id":"nozzly.app-aea","title":"MEDIUM: QR Code scanning for spool lookup","description":"Camera integration for mobile PWA. Scan QR codes to lookup spools instantly. Requires react-qr-reader or similar library.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T03:59:27.620896Z","created_by":"jonathan","updated_at":"2026-01-04T04:25:06.149449Z","closed_at":"2026-01-04T04:25:06.149449Z","close_reason":"QR Code scanning fully implemented: QRScanner.tsx component with html5-qrcode library, SpoolScanPage.tsx, parseSpoolQRCode function. Camera-based scanner with haptic feedback, camera switching, error handling."}
{"id":"nozzly.app-ahx","title":"CRITICAL: Transaction handling without rollback in production run service","description":"File: backend/app/services/production_run.py (lines 519-585)\n\nNo rollback on error in complete_production_run():\n- Partial spool updates before commit\n- If commit fails, inventory state inconsistent\n\nFix: Use database transaction isolation or implement compensating transactions.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:56.986538Z","created_by":"jonathan","updated_at":"2026-01-01T17:18:35.18405Z","closed_at":"2026-01-01T17:18:35.18405Z","close_reason":"Added explicit rollback to all production run exception handlers"}
{"id":"nozzly.app-as9","title":"Add drag-and-drop image reordering to ProductImagesEditor","description":"Backend API already supports display_order field on ProductImage model. Need to add drag-and-drop reordering UI to ProductImagesEditor.tsx component. Should use a library like @dnd-kit/core or react-beautiful-dnd. When user drags images to reorder, call PATCH /api/v1/products/{product_id}/images/{image_id} with new display_order values.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-06T13:18:31.395022Z","created_by":"jonathan","updated_at":"2026-01-06T13:18:48.12397Z"}
{"id":"nozzly.app-b3x","title":"Configure Woodpecker secrets for staging Square sandbox","description":"Add Woodpecker CI secrets for mystmereforge-shop staging builds:\n\n1. Login to Woodpecker CI (ci.techize.co.uk)\n2. Go to mystmereforge-shop repo settings\n3. Add secrets:\n   - vite_square_app_id_sandbox: Square sandbox app ID\n   - vite_square_location_id_sandbox: Square sandbox location ID\n\nGet sandbox credentials from Square Developer Dashboard.\n\nBlocked by: c37 (Square sandbox credentials)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T15:10:36.857577Z","created_by":"jonathan","updated_at":"2026-01-06T15:27:13.927661Z","closed_at":"2026-01-06T15:27:13.927661Z","close_reason":"Square sandbox credentials configured: K8s secret in nozzly-staging namespace, Woodpecker secrets for CI/CD builds","dependencies":[{"issue_id":"nozzly.app-b3x","depends_on_id":"nozzly.app-c37","type":"blocks","created_at":"2026-01-06T15:10:42.737803Z","created_by":"jonathan"}]}
{"id":"nozzly.app-bah","title":"MEDIUM: CORS uses wildcard methods/headers","description":"File: backend/app/main.py (lines 74-75)\n\nallow_methods=['*'] and allow_headers=['*'] are too permissive.\n\nFix: Use explicit lists:\n- allow_methods=['GET', 'POST', 'PUT', 'DELETE', 'PATCH']\n- allow_headers=['Authorization', 'Content-Type', 'X-Tenant-ID']","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:34:47.019183Z","created_by":"jonathan","updated_at":"2026-01-01T20:12:25.592002Z","closed_at":"2026-01-01T20:12:25.592002Z","close_reason":"Fixed - CORS now uses explicit methods and headers instead of wildcards"}
{"id":"nozzly.app-bdb","title":"Epic: Product Creation Wizard","description":"Multi-step wizard for creating products from models. Guides users through: 1) Model selection (search/browse), 2) Product details (name/description prefilled from model), 3) Adding multiple models, 4) Category selection, 5) Packaging configuration. Improves UX over current single-form approach.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-04T22:16:38.885993Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:31.182422Z","closed_at":"2026-01-04T22:27:31.182422Z","close_reason":"All wizard steps implemented and integrated into ProductList"}
{"id":"nozzly.app-btd","title":"MEDIUM: Production debug logging still active","description":"Multiple files have console.log/print statements visible in production:\n\nBackend:\n- backend/app/api/v1/products.py (lines 1490-1495): DEBUG print statements\n- backend/app/api/v1/auth.py: Token logging\n\nFrontend:\n- frontend/src/lib/api.ts (lines 46-48, 88, 91): Token expiration logging\n- frontend/src/components/inventory/SpoolList.tsx: Offline state logging\n\nFix: Wrap with conditional checks (import.meta.env.DEV) or use proper logging module.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:34:42.100535Z","created_by":"jonathan","updated_at":"2026-01-01T19:51:36.694111Z","closed_at":"2026-01-01T19:51:36.694111Z","close_reason":"Fixed: Removed debug console.log statements from frontend api.ts and print statements from backend products.py"}
{"id":"nozzly.app-bwn","title":"Searchable spool dropdown with colour filtering in BOM dialogs","description":"Add typeahead/autocomplete filtering to spool dropdown in Add Material and Edit Material dialogs for bill of materials. User should be able to type colour names (e.g. 'white') to filter the spool list. Apply to all BOM-related dialogs consistently.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T12:21:13.237987Z","created_by":"jonathan","updated_at":"2026-01-06T12:02:57.506125Z","closed_at":"2026-01-06T12:02:57.506125Z","close_reason":"Already completed via nvn - BOMEditor Add Material dialog now uses SearchableSpoolSelect with color filtering"}
{"id":"nozzly.app-c17","title":"Create tenant_modules database table","description":"Create migration for tenant_modules junction table:\n- id (UUID, PK)\n- tenant_id (UUID, FK -\u003e tenants, ON DELETE CASCADE)\n- module_name (VARCHAR(50), NOT NULL)\n- enabled (BOOLEAN, default TRUE)\n- enabled_by_user_id (UUID, FK -\u003e users, nullable)\n- created_at, updated_at timestamps\n- UNIQUE constraint on (tenant_id, module_name)\n- Index on tenant_id for fast lookups","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:35:50.965272Z","created_by":"jonathan","updated_at":"2026-01-04T14:46:25.014011Z","closed_at":"2026-01-04T14:46:25.014011Z","close_reason":"Migration i3j4k5l6m7n8 created and pushed","dependencies":[{"issue_id":"nozzly.app-c17","depends_on_id":"nozzly.app-75k","type":"blocks","created_at":"2026-01-04T14:37:54.315375Z","created_by":"jonathan"}]}
{"id":"nozzly.app-c37","title":"Configure Square sandbox credentials for staging","description":"Set up Square sandbox credentials for payment testing in staging:\n\n1. Login to Square Developer Dashboard\n2. Get sandbox credentials (access token, app ID, location ID, webhook key)\n3. Create square-credentials secret in nozzly-staging namespace\n4. Test payment flow in staging environment\n\nRef: README.md Configuration Management section for command template","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T15:00:28.18845Z","created_by":"jonathan","updated_at":"2026-01-06T15:27:13.926231Z","closed_at":"2026-01-06T15:27:13.926231Z","close_reason":"Square sandbox credentials configured: K8s secret in nozzly-staging namespace, Woodpecker secrets for CI/CD builds"}
{"id":"nozzly.app-c6a","title":"CRITICAL: Missing tenant_id in OrderItem model","description":"File: backend/app/models/order.py (lines 291-356)\n\nOrderItem has NO tenant_id field, only order_id FK.\n\nImpact: Direct database queries could bypass tenant isolation.\n\nFix: Add tenant_id indexed column with FK to tenants.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:36.34071Z","created_by":"jonathan","updated_at":"2026-01-01T17:02:58.858497Z","closed_at":"2026-01-01T17:02:58.858497Z","close_reason":"Added tenant_id to both tables with migration and test fixes"}
{"id":"nozzly.app-cbk","title":"Console errors: disconnected port object in proxy.js","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-05T15:00:46.213625Z","created_by":"jonathan","updated_at":"2026-01-06T15:51:27.294668Z","closed_at":"2026-01-06T15:51:27.294668Z","close_reason":"Browser extension issue (React DevTools/etc), not nozzly.app code. No fix needed."}
{"id":"nozzly.app-cjf","title":"CRITICAL: No automated database backups","description":"Evidence: Single manual backup exists from Dec 6 (25 days old).\n\nIssues:\n- No backup schedule\n- No retention policy  \n- No tested restore procedure\n- Single PostgreSQL replica with local-path storage\n- No RTO/RPO defined\n\nFix: Implement daily automated backups with 30-day retention. Document disaster recovery.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:39.052545Z","created_by":"jonathan","updated_at":"2026-01-01T17:27:07.702071Z","closed_at":"2026-01-01T17:27:07.702071Z","close_reason":"Added automated daily backup CronJob with 30-day retention"}
{"id":"nozzly.app-d3x","title":"Default module configuration per tenant type","description":"Define default enabled modules per tenant_type (three_d_print, hand_knitting, machine_knitting, generic). Auto-populate tenant_modules on tenant creation. Create migration for existing tenants to get their defaults.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T14:37:32.426521Z","created_by":"jonathan","updated_at":"2026-01-04T14:37:32.426521Z","dependencies":[{"issue_id":"nozzly.app-d3x","depends_on_id":"nozzly.app-p4w","type":"blocks","created_at":"2026-01-04T14:37:46.155896Z","created_by":"jonathan"}]}
{"id":"nozzly.app-d5e","title":"TipTap warning: Duplicate extension names ['link']","description":"Console warning: '[tiptap warn]: Duplicate extension names found: [\"link\"]. This can lead to issues.' Appears in vendor-editor-BGrtBaFk.js:10. The RichTextEditor uses StarterKit + explicit Link extension. StarterKit doesn't include Link by default, so either double-initialization, dependency conflict, or another component registering Link.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-05T18:12:20.993135Z","created_by":"jonathan","updated_at":"2026-01-06T15:44:11.88021Z","closed_at":"2026-01-06T15:44:11.88021Z","close_reason":"Added immediatelyRender: false to fix StrictMode double-initialization"}
{"id":"nozzly.app-d5g","title":"Currency hardcoded inconsistently ($ in runs, £ in products)","description":"## Problem\nProduction run detail page uses hardcoded $ currency symbol while products use hardcoded £.\n\n## Root Cause\n- `ProductionRunDetail.tsx` lines 328, 350, 365, 369, 381: uses \\`\\${value.toFixed(2)}\\`\n- `products.ts formatCurrency()`: hardcoded to \\`£\\`\n- Neither uses tenant localization settings\n\n## Required Fix\n1. Add currency_symbol field to tenant settings (if not present)\n2. Create shared formatCurrency hook/utility that reads tenant currency\n3. Replace all hardcoded currency symbols with the tenant-aware formatter\n\n## Files to Modify\n- `frontend/src/components/production-runs/ProductionRunDetail.tsx`\n- `frontend/src/lib/api/products.ts`\n- Possibly create `frontend/src/hooks/useCurrency.ts` or similar","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T14:05:22.664116Z","created_by":"jonathan","updated_at":"2026-01-06T14:08:23.415122Z","closed_at":"2026-01-06T14:08:23.415122Z","close_reason":"Fixed by importing formatCurrency from products.ts and replacing all hardcoded $ symbols. All production run costs now display £ consistently. Follow-up bead needed for proper tenant-aware currency."}
{"id":"nozzly.app-dju","title":"MEDIUM: Horizontal Pod Autoscaling","description":"K8s infrastructure gap. No HPA configured. Add CPU/memory based autoscaling for backend and frontend deployments.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T03:59:55.543582Z","created_by":"jonathan","updated_at":"2026-01-04T03:59:55.543582Z"}
{"id":"nozzly.app-e1r","title":"MEDIUM: API documentation (OpenAPI/Swagger UI)","description":"FastAPI auto-generates OpenAPI spec but needs custom docs. Add endpoint descriptions, example requests/responses, authentication docs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T03:59:45.037223Z","created_by":"jonathan","updated_at":"2026-01-04T04:25:19.854362Z","closed_at":"2026-01-04T04:25:19.854362Z","close_reason":"API documentation exists via FastAPI auto-generated OpenAPI: /docs (Swagger UI) and /redoc (ReDoc) in development mode. Production uses docs_url=None for security."}
{"id":"nozzly.app-e48","title":"API endpoints for model file management","description":"Create /api/v1/models/{id}/files endpoints: POST for upload (multipart), GET to list files, GET /{file_id} for download, DELETE /{file_id}, PATCH /{file_id} for metadata updates. Support chunked upload for large files (50MB+). Add proper auth and tenant isolation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T16:12:06.929682Z","created_by":"jonathan","updated_at":"2026-01-04T18:07:03.496797Z","closed_at":"2026-01-04T18:07:03.496797Z","close_reason":"API endpoints created - commit 5bc67fa","dependencies":[{"issue_id":"nozzly.app-e48","depends_on_id":"nozzly.app-xg0","type":"blocks","created_at":"2026-01-04T16:12:18.175956Z","created_by":"jonathan"}]}
{"id":"nozzly.app-eb6","title":"Knitting vertical module (Olive and Wool)","description":"saas-evolution Phase 2. New vertical for knitters: yarn inventory, needle collection, pattern library, project tracking, sizing system. 7 tasks, ~4-5 weeks.","status":"closed","priority":3,"issue_type":"epic","created_at":"2026-01-04T03:59:44.892337Z","created_by":"jonathan","updated_at":"2026-01-04T04:26:21.900319Z","closed_at":"2026-01-04T04:26:21.900319Z","close_reason":"Knitting vertical implemented: Backend modules (yarn.py, needle.py, pattern.py, project.py) with API routes. Frontend pages (KnittingDashboard, YarnInventory, NeedleCollection, Patterns, Projects). Module system with tenant-type filtering (HAND_KNITTING, MACHINE_KNITTING)."}
{"id":"nozzly.app-ez9","title":"CI/CD pipeline for staging deployments","description":"Update Woodpecker CI pipelines:\n\nFor nozzly.app:\n- Build and push staging image on main branch\n- Auto-deploy to staging namespace\n- Manual promotion to production (or tag-based)\n\nFor mystmereforge-shop:\n- Build staging image\n- Auto-deploy to staging\n- Manual promotion to production\n\nConsider:\n- Branch strategy (main → staging, tags → prod?)\n- Rollback procedures\n- Health check gates before promotion","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:45.821249Z","created_by":"jonathan","updated_at":"2026-01-06T15:10:18.35283Z","closed_at":"2026-01-06T15:10:18.35283Z","close_reason":"Added staging-first CI/CD deployment strategy. Both nozzly-backend and mystmereforge-shop now deploy to staging first, wait for health check, then deploy to production. Shop builds separate staging images with staging API URL.","dependencies":[{"issue_id":"nozzly.app-ez9","depends_on_id":"nozzly.app-l8z","type":"blocks","created_at":"2026-01-06T12:55:04.19909Z","created_by":"jonathan"},{"issue_id":"nozzly.app-ez9","depends_on_id":"nozzly.app-6gi","type":"blocks","created_at":"2026-01-06T12:55:04.258051Z","created_by":"jonathan"}]}
{"id":"nozzly.app-f6q","title":"MEDIUM: Label Printing Integration","description":"Taskmaster Task 23. Nelko PM230 hardware integration via BLE. QR code generation for spools. Mobile PWA feature. Spec in LABEL_PRINTING.md.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T03:59:27.450629Z","created_by":"jonathan","updated_at":"2026-01-04T04:25:06.267739Z","closed_at":"2026-01-04T04:25:06.267739Z","close_reason":"Label Printing fully implemented: SpoolLabelPage.tsx with QR code generation (qrcode.react), optimized for 54mm thermal printers, shows spool ID, material, brand, color, finish. Print-ready design."}
{"id":"nozzly.app-ff3","title":"HIGH: Missing tenant_id in ProductVariant model","description":"File: backend/app/models/product_variant.py (lines 85-91)\n\nProductVariant lacks tenant_id field, only has product_id FK.\n\nWhile variants are isolated via product relationship, multi-tenant best practice requires explicit tenant_id for consistency and RLS enforcement.\n\nFix: Add tenant_id field for consistency with other models.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:33.571352Z","created_by":"jonathan","updated_at":"2026-01-01T19:46:47.177169Z","closed_at":"2026-01-01T19:46:47.177169Z","close_reason":"Fixed: Added tenant_id field to ProductVariant model and created migration to populate from parent product"}
{"id":"nozzly.app-gb9","title":"Customer auth returning 422 for mystmereforge shop","description":"The customer auth endpoints (/api/v1/customer/auth/*) are returning 422 validation errors when called from mystmereforge.co.uk shop frontend. Login was getting 404 earlier. Need to investigate:\\n1. Whether customer auth is properly enabled for external shops\\n2. What validation is failing (password requirements? shop hostname validation?)\\n3. Whether shop-based tenant isolation is working correctly\\n\\nThe shop frontend sends X-Shop-Hostname header but the backend may not be configured to accept registrations from mystmereforge.co.uk","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T20:05:39.118315Z","created_by":"jonathan","updated_at":"2026-01-06T12:28:54.626481Z","closed_at":"2026-01-06T12:28:54.626481Z","close_reason":"Fixed - frontend now uses dynamic hostname via getShopHostname() and backend migration updated to use test.mystmereforge.co.uk"}
{"id":"nozzly.app-h21","title":"HIGH: Auth/authorization testing coverage only 5%","description":"Only 8 auth error tests across entire test suite.\n\nMissing:\n- 401 Unauthorized response tests\n- 403 Forbidden on cross-tenant access\n- Missing/invalid token tests\n- Expired JWT token tests\n- Permission-based access control tests\n- JWT refresh token flow tests\n\nRisk: Users could access unauthorized endpoints or data.\n\nEstimate: 50+ tests needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-31T17:34:10.421915Z","created_by":"jonathan","updated_at":"2026-01-03T18:03:52.735865Z","closed_at":"2026-01-03T18:03:52.735865Z","close_reason":"Added 25 auth/authorization tests covering: 401 responses (missing/invalid/expired tokens), 403 forbidden scenarios, token refresh flow, role-based access, password security"}
{"id":"nozzly.app-hfr","title":"Epic: Staging/Test Environment for Nozzly + Shop","description":"Set up proper staging environment to test changes before production. Currently no way to test the mystmereforge shop or nozzly.app changes without affecting live production.\n\nRequirements:\n- Separate staging instances of nozzly.app backend\n- Separate staging instance of mystmereforge-shop frontend  \n- Staging database (or tenant isolation)\n- Staging custom domain (e.g., staging.mystmereforge.co.uk)\n- CI/CD pipeline updates to deploy to staging first\n- Environment-specific configuration management","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-06T12:53:26.207089Z","created_by":"jonathan","updated_at":"2026-01-06T15:11:21.571257Z","closed_at":"2026-01-06T15:11:21.571257Z","close_reason":"Core staging environment complete: backend at staging.nozzly.app, shop at staging.mystmereforge.co.uk, CI/CD pipelines configured. Remaining P3 tasks (c37, b3x) are for Square sandbox credentials setup."}
{"id":"nozzly.app-hp8","title":"MEDIUM: Frontend image pull policy allows stale images","description":"File: infrastructure/k8s/frontend/deployment.yaml (line 42)\n\nimagePullPolicy: IfNotPresent allows cached images.\nBackend uses Always, frontend doesn't.\n\nRisk: Frontend could run stale/compromised images if tag is cached locally.\n\nFix: Change to imagePullPolicy: Always for consistency.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:34:45.993596Z","created_by":"jonathan","updated_at":"2026-01-01T20:12:47.59226Z","closed_at":"2026-01-01T20:12:47.59226Z","close_reason":"Fixed - imagePullPolicy changed to Always for consistency with backend"}
{"id":"nozzly.app-hwk","title":"MEDIUM: Infinite recursion risk in costing service","description":"File: backend/app/services/costing.py (lines 139-148)\n\nRecursive product costing has no depth limit:\n- visited set copied each level\n- Very deep product hierarchies could cause stack overflow\n\nFix: Add max_depth parameter with reasonable limit (e.g., 20 levels).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:34:43.4345Z","created_by":"jonathan","updated_at":"2026-01-01T20:30:07.538023Z","closed_at":"2026-01-01T20:30:07.538023Z","close_reason":"Fixed - added MAX_RECURSION_DEPTH (20) limit with MaxDepthExceededError"}
{"id":"nozzly.app-im3","title":"CRITICAL: Hardcoded database password in K8s manifests","description":"File: infrastructure/k8s/postgres/statefulset.yaml (line 9) and backend ConfigMap (line 7)\n\nIssue: Postgres uses hardcoded password 'changeme-in-production' in plaintext ConfigMap.\nDATABASE_URL with password visible in repo: postgresql+psycopg://nozzly:changeme-in-production@postgres:5432/nozzly\n\nFix: Move to Kubernetes Secret, rotate immediately.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:33.898575Z","created_by":"jonathan","updated_at":"2025-12-31T17:52:11.797134Z","closed_at":"2025-12-31T17:52:11.797134Z","close_reason":"Removed hardcoded password from repo, now uses kubectl secret creation"}
{"id":"nozzly.app-j99","title":"Set up Sentry error monitoring for frontend and backend","description":"Sentry is not configured anywhere in nozzly.app. Need to:\n\n**Frontend (React/Vite):**\n- Install @sentry/react and @sentry/vite-plugin\n- Initialize in main.tsx with DSN from env\n- Configure source maps upload in vite.config.ts\n- Add ErrorBoundary wrapper for React errors\n- Configure browser tracing (coordinate with existing OpenTelemetry)\n\n**Backend (FastAPI):**\n- Install sentry-sdk[fastapi]\n- Initialize in app startup with DSN from env\n- Configure ASGI middleware for request tracing\n- Set up environment/release tags\n\n**Infrastructure:**\n- Create Sentry project (or use existing org)\n- Add SENTRY_DSN to .env files and CI secrets\n- Configure release tracking with git SHA\n- Set up alerts for error thresholds\n\n**Testing:**\n- Add test endpoint to trigger error\n- Verify errors appear in Sentry dashboard","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T18:14:51.162909Z","created_by":"jonathan","updated_at":"2026-01-05T18:14:51.162909Z"}
{"id":"nozzly.app-jyl","title":"HIGH: Multi-Step Production Run Form Wizard","description":"Taskmaster Task 15. 4-step form: Basic Info → Items → Materials → Review. Validation, localStorage draft saving. API ready, UI pending.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T03:59:26.801553Z","created_by":"jonathan","updated_at":"2026-01-04T04:16:22.320237Z","closed_at":"2026-01-04T04:16:22.320237Z","close_reason":"Already implemented. CreateRunWizard.tsx (1706 lines) with 4-step flow: Basic Info → Models → Materials → Review. 11 tests passing. Split filament tracking, BOM-based material suggestions, inventory validation all working."}
{"id":"nozzly.app-kzs","title":"Code Review - December 2025","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-31T17:32:08.947274Z","created_by":"jonathan","updated_at":"2026-01-03T18:11:33.529985Z","closed_at":"2026-01-03T18:11:33.529985Z","close_reason":"All code review findings addressed: Orders API tests (40), Auth tests (25), Frontend tests (28), Security scanning (Trivy+SBOM). Total backend tests: 1804, frontend coverage: 46%"}
{"id":"nozzly.app-l8z","title":"K8s staging namespace and base resources for nozzly-backend","description":"Create k8s manifests for staging environment:\n- New namespace (nozzly-staging or similar)\n- ConfigMaps for staging-specific config\n- Secrets references\n- Service account and RBAC if needed\n\nShould mirror production structure but with staging-specific values.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T12:54:30.248632Z","created_by":"jonathan","updated_at":"2026-01-06T13:37:57.749116Z","closed_at":"2026-01-06T13:37:57.749116Z","close_reason":"Staging backend deployed and running. Namespace, deployment, service, configmap, secrets all configured. Schema copied from production. Backend healthy at staging environment.","dependencies":[{"issue_id":"nozzly.app-l8z","depends_on_id":"nozzly.app-8gg","type":"blocks","created_at":"2026-01-06T12:55:04.017136Z","created_by":"jonathan"}]}
{"id":"nozzly.app-m1u","title":"CRITICAL: Race condition in stock reservation","description":"File: backend/app/services/stock_reservation.py (lines 156-175)\n\nNon-atomic check-then-act pattern: \n1. Reads reserved quantity\n2. Checks availability  \n3. Later writes reservation to Redis\n\nBetween checking and reserving, another session could reserve same stock.\n\nFix: Use Redis WATCH/MULTI/EXEC transactions or Lua scripts for atomicity.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:37.788291Z","created_by":"jonathan","updated_at":"2026-01-01T17:25:42.926676Z","closed_at":"2026-01-01T17:25:42.926676Z","close_reason":"Implemented atomic Lua script for stock reservation"}
{"id":"nozzly.app-mes","title":"HIGH: Missing unique constraint on DiscountCode per tenant","description":"File: backend/app/models/discount.py (lines 42-47)\n\nCode is indexed but not unique per tenant. Same code could be created twice.\n\nComment says 'unique per tenant' but constraint is missing.\n\nFix: Add UniqueConstraint('tenant_id', 'code', name='uq_discount_code_tenant') to __table_args__.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:34:11.610042Z","created_by":"jonathan","updated_at":"2026-01-01T19:48:48.321478Z","closed_at":"2026-01-01T19:48:48.321478Z","close_reason":"Fixed: Added UniqueConstraint on (tenant_id, code) to discount_codes table with migration"}
{"id":"nozzly.app-msv","title":"Fix CI/CD infrastructure - Woodpecker builds failing","description":"Woodpecker CI builds are failing with exit code 1. Harbor registry push from Mac fails with 'authorize header needed' error. This is blocking proper deployment of code changes. Currently using ConfigMap workaround for is_dragon fix.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T12:55:15.300607Z","created_by":"jonathan","updated_at":"2026-01-05T15:28:32.618262Z","closed_at":"2026-01-05T15:28:32.618262Z","close_reason":"Fixed test to use is_dragon instead of is_featured. CI pipeline #423 passed. Test file: backend/tests/api/test_shop_checkout.py"}
{"id":"nozzly.app-nn7","title":"Wizard Step 3: Category Selection Component","description":"Create category selection step. Display available categories with hierarchy. Allow selecting multiple categories. Show category badges/tags.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T22:17:04.845816Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:25.543693Z","closed_at":"2026-01-04T22:27:25.543693Z","close_reason":"Implemented as part of wizard container task","dependencies":[{"issue_id":"nozzly.app-nn7","depends_on_id":"nozzly.app-76h","type":"blocks","created_at":"2026-01-04T22:17:25.462564Z","created_by":"jonathan"}]}
{"id":"nozzly.app-ntg","title":"Frontend admin page for tenant module management","description":"Create /platform/tenants/{id}/modules admin page with: List of all available modules with toggle switches, visual indication of default vs custom config, reset to defaults button, confirmation dialogs for changes. Platform admin only access.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T14:37:32.286354Z","created_by":"jonathan","updated_at":"2026-01-04T14:37:32.286354Z","dependencies":[{"issue_id":"nozzly.app-ntg","depends_on_id":"nozzly.app-zsa","type":"blocks","created_at":"2026-01-04T14:37:46.036287Z","created_by":"jonathan"}]}
{"id":"nozzly.app-nvn","title":"Update BOMEditor Add Material dialog with searchable spool select","description":"Replace the Select component in BOMEditor.tsx Add Material dialog with the new SearchableSpoolSelect component. Ensure handleSpoolSelect still works for auto-filling cost_per_gram.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T12:22:06.518656Z","created_by":"jonathan","updated_at":"2026-01-06T11:26:23.986622Z","closed_at":"2026-01-06T11:26:23.986622Z","close_reason":"Replaced Select with SearchableSpoolSelect in BOMEditor Add Material dialog","dependencies":[{"issue_id":"nozzly.app-nvn","depends_on_id":"nozzly.app-tch","type":"blocks","created_at":"2026-01-05T12:22:17.426448Z","created_by":"jonathan"}]}
{"id":"nozzly.app-oes","title":"Update modules API to read from tenant_modules table","description":"Modify /api/v1/modules endpoint to check tenant_modules table for enabled/disabled status instead of hardcoded logic. Fall back to defaults if no tenant_modules record exists. Ensure proper caching for performance.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T14:37:32.018258Z","created_by":"jonathan","updated_at":"2026-01-04T14:37:32.018258Z","dependencies":[{"issue_id":"nozzly.app-oes","depends_on_id":"nozzly.app-p4w","type":"blocks","created_at":"2026-01-04T14:37:45.79896Z","created_by":"jonathan"}]}
{"id":"nozzly.app-oxs","title":"MEDIUM: Hardcoded URLs in email service","description":"File: backend/app/services/email_service.py (lines 793-795, 885-887)\n\nURLs hardcoded instead of configured:\nverification_url = f'https://www.mystmereforge.co.uk/verify-email?token={token}'\n\nFix: Load from config settings. Makes testing and multi-domain deployments difficult.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:34:44.655119Z","created_by":"jonathan","updated_at":"2026-01-01T20:32:41.774663Z","closed_at":"2026-01-01T20:32:41.774663Z","close_reason":"Fixed - added frontend_base_url config, email service now uses configurable URLs"}
{"id":"nozzly.app-p08","title":"HIGH: XSS vulnerability - dangerouslySetInnerHTML in ProductDetail","description":"File: frontend/src/components/products/ProductDetail.tsx (line 334)\n\nUses dangerouslySetInnerHTML={{ __html: product.description }} without sanitization.\n\nRisk: If product descriptions are user-generated or imported, XSS attacks possible.\n\nFix: Use DOMPurify sanitization library or react-markdown for safe rendering.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:25.555081Z","created_by":"jonathan","updated_at":"2026-01-01T19:42:20.571587Z","closed_at":"2026-01-01T19:42:20.571587Z","close_reason":"Fixed: Added DOMPurify sanitization to product.description before rendering with dangerouslySetInnerHTML"}
{"id":"nozzly.app-p4w","title":"Backend TenantModule model and service layer","description":"Create SQLAlchemy TenantModule model with proper relationships to Tenant. Implement TenantModuleService with CRUD operations: get_tenant_modules(), set_module_enabled(), reset_to_defaults(). Include audit logging for enable/disable actions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:37:31.887175Z","created_by":"jonathan","updated_at":"2026-01-04T19:31:27.770152Z","closed_at":"2026-01-04T19:31:27.770152Z","close_reason":"TenantModule model/service created plus fixed missing navigation module classes","dependencies":[{"issue_id":"nozzly.app-p4w","depends_on_id":"nozzly.app-c17","type":"blocks","created_at":"2026-01-04T14:37:45.681574Z","created_by":"jonathan"}]}
{"id":"nozzly.app-p9f","title":"Implement tenant-aware currency formatting","description":"## Background\nCurrency is currently hardcoded to £ in formatCurrency() (products.ts). This works for Mystmereforge (UK business) but won't work for multi-currency tenants.\n\n## Implementation Required\n\n### Backend Changes\n1. Add currency fields to Tenant settings JSON:\n   - currency_code: 'GBP' | 'USD' | 'EUR' etc.\n   - currency_symbol: '£' | '$' | '€' etc.\n2. Update /api/v1/users/me response to include tenant currency settings\n3. Alternatively, create dedicated /api/v1/settings/currency endpoint\n\n### Frontend Changes\n1. Update User interface in auth.ts to include tenant currency\n2. Create useCurrency hook:\n   - Access currency from AuthContext\n   - Provide formatCurrency function using Intl.NumberFormat\n3. Update all currency formatting:\n   - products.ts formatCurrency() \n   - OrderList.tsx formatCurrency()\n   - ProductionRunDetail.tsx (uses products.ts formatCurrency)\n   - Any other hardcoded currency displays\n\n### Files Involved\n- backend/app/models/tenant.py (settings JSON structure)\n- backend/app/routers/users.py (users/me endpoint)\n- frontend/src/lib/auth.ts (User interface)\n- frontend/src/contexts/AuthContext.tsx\n- frontend/src/lib/api/products.ts\n- frontend/src/components/orders/OrderList.tsx\n- Multiple component files using currency\n\n## Low Priority\nThis is P3 because the hardcoded £ works for current tenant (Mystmereforge).","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-06T14:08:38.986806Z","created_by":"jonathan","updated_at":"2026-01-06T14:08:38.986806Z"}
{"id":"nozzly.app-q8r","title":"MEDIUM: Payment webhook robustness","description":"Square refund webhooks, payment failure handling, idempotency. Ensure all payment state changes are properly tracked and recoverable.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T03:59:45.175075Z","created_by":"jonathan","updated_at":"2026-01-04T03:59:45.175075Z"}
{"id":"nozzly.app-rlr","title":"Backend API for wizard data aggregation","description":"Create/update API endpoints to support wizard flow. May need endpoint to fetch model details for prefilling, and ensure product creation endpoint handles wizard payload structure.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T22:17:05.345478Z","created_by":"jonathan","updated_at":"2026-01-04T22:27:25.545838Z","closed_at":"2026-01-04T22:27:25.545838Z","close_reason":"Implemented as part of wizard container task"}
{"id":"nozzly.app-shc","title":"HIGH: MinIO using hardcoded credentials in repo","description":"File: infrastructure/k8s/minio/minio.yaml (lines 8-10)\n\nCredentials visible in repo:\n- MINIO_ROOT_USER: nozzly-minio\n- MINIO_ROOT_PASSWORD: nozzly-minio-secret-2024\n\nFix: Move to Kubernetes Secret, rotate immediately.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:34.69296Z","created_by":"jonathan","updated_at":"2026-01-01T19:45:02.261959Z","closed_at":"2026-01-01T19:45:02.261959Z","close_reason":"Fixed: Removed hardcoded credentials from minio.yaml. Added instructions for manual secret creation. NOTE: Password was in git history - recommend rotation"}
{"id":"nozzly.app-tch","title":"Create SearchableSpoolSelect reusable component","description":"Create a reusable component that wraps the Combobox with spool-specific logic: displays spool_id, material_type, and color; filters on color name as user types; handles spool selection with onValueChange callback.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T12:22:06.35073Z","created_by":"jonathan","updated_at":"2026-01-06T10:56:23.149992Z","closed_at":"2026-01-06T10:56:23.149992Z","close_reason":"Added SearchableSpoolSelect component with 13 passing tests","dependencies":[{"issue_id":"nozzly.app-tch","depends_on_id":"nozzly.app-x9v","type":"blocks","created_at":"2026-01-05T12:22:17.385131Z","created_by":"jonathan"}]}
{"id":"nozzly.app-u7g","title":"MEDIUM: No security scanning in CI pipeline","description":"File: .woodpecker/build.yml\n\nCI pipeline lacks:\n- Container image scanning (Trivy, Snyk)\n- Dependency vulnerability scanning\n- SBOM generation\n- Provenance/attestation\n\nFix: Add security scanning step before registry push.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:34:49.613856Z","created_by":"jonathan","updated_at":"2026-01-03T18:10:17.598041Z","closed_at":"2026-01-03T18:10:17.598041Z","close_reason":"Added Trivy security scanning to CI: dependency scanning, container image scanning, SBOM generation (SPDX). Builds blocked on HIGH/CRITICAL vulns."}
{"id":"nozzly.app-w75","title":"Fix model file upload error","description":"Model file upload is giving an error. Needs investigation to identify the root cause and fix. Could be frontend, backend API, or MinIO storage related.","notes":"Fix deployed to production (commit 4fc502b, deployed with 8cbb2fb). Improved error handling includes: detailed logging throughout S3 upload flow, validation for S3 client initialization, handling for common S3 errors (NoSuchBucket, AccessDenied, InvalidAccessKeyId, SignatureDoesNotMatch). Diagnostic script confirms code works. Ready for user verification - test file upload when logged in.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T23:00:15.270805Z","created_by":"jonathan","updated_at":"2026-01-06T13:05:56.759041Z","closed_at":"2026-01-06T13:05:56.759041Z","close_reason":"Fix deployed to production. Improved S3 error handling with detailed logging. User can verify by testing file upload - if issues persist, backend logs will now show specific error messages."}
{"id":"nozzly.app-x91","title":"CRITICAL: Password reset tokens logged to stdout","description":"File: backend/app/api/v1/auth.py (lines 227-230)\n\nPassword reset tokens printed to stdout:\n- print(f'Password reset token for {user.email}: {reset_token}')\n- print(f'Reset link: https://nozzly.app/reset-password?token={reset_token}')\n\nImpact: Anyone with log access can reset any user password.\n\nFix: Remove print statements. Tokens must only be sent via email.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T17:32:55.006365Z","created_by":"jonathan","updated_at":"2025-12-31T17:44:30.10146Z","closed_at":"2025-12-31T17:44:30.10146Z","close_reason":"Removed print statements, added send_admin_password_reset email method"}
{"id":"nozzly.app-x9v","title":"Add Combobox UI component from shadcn","description":"Install shadcn combobox component which provides searchable/filterable dropdown functionality. This is a prerequisite for searchable spool selection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T12:22:06.183627Z","created_by":"jonathan","updated_at":"2026-01-06T10:38:26.919183Z","closed_at":"2026-01-06T10:38:26.919183Z","close_reason":"Added Combobox component with full test coverage"}
{"id":"nozzly.app-xey","title":"Production run waste not included in product cost","description":"# Production Run Cost Tracking - Comprehensive Solution\n\n## Problem Statement\n\nProducts like \"Red Squirrel Set\" or \"Axolotl\" have multiple models (parts). To know actual production cost:\n1. Need to track cost across multiple plates/runs\n2. Need to distribute waste (purge, tower, supports, failures) fairly\n3. Need to roll up model costs to product cost\n\n## The Elegant Solution: Weight-Proportional Batch Costing\n\n### Core Formula\n\n```\ncost_per_gram_actual = total_material_cost / total_successful_weight\nmodel_actual_cost = model_theoretical_weight × cost_per_gram_actual\n```\n\n**Why this works:**\n- Waste is automatically distributed by weight (heavier models absorb proportionally more)\n- Failed prints are absorbed by successful ones (their cost increases)\n- Works for mixed-model beds\n- Simple, fair, industry-standard approach\n\n### Example\n\nRun prints:\n- 5× Dragon Body (20g each = 100g theoretical)\n- 10× Dragon Wing (10g each = 100g theoretical)\n- Total theoretical: 200g\n\nActual material used: 250g (includes purge, tower, supports, 2 failures)\nTotal material cost: £5.00\n\n```\ncost_per_gram_actual = £5.00 / 200g = £0.025/g\n\nDragon Body (4 successful): £0.025 × 20g = £0.50 each\nDragon Wing (10 successful): £0.025 × 10g = £0.25 each\n```\n\n**Waste absorbed = 50g (25%)** - automatically distributed.\n\n---\n\n## Implementation Design\n\n### Phase 1: Run-Level Cost Analysis (MVP)\n\n**Data Model Changes:**\n\n```python\n# ProductionRun - add fields:\ncost_per_gram_actual = Column(Numeric(10, 6))  # Calculated on completion\nsuccessful_weight_grams = Column(Numeric(10, 2))  # Sum of successful item weights\n\n# ProductionRunItem - add fields:\nactual_cost_per_unit = Column(Numeric(10, 4))  # model_weight × cost_per_gram_actual\nmodel_weight_grams = Column(Numeric(10, 2))    # Cached from model BOM for calculation\n```\n\n**Calculation on Run Completion:**\n\n```python\ndef calculate_run_costs(run: ProductionRun):\n    # Step 1: Get total material cost (already calculated)\n    total_cost = run.total_material_cost\n    \n    # Step 2: Calculate total successful weight from items\n    successful_weight = Decimal(\"0\")\n    for item in run.items:\n        model_weight = sum(m.weight_grams for m in item.model.materials)\n        item.model_weight_grams = model_weight  # Cache it\n        successful_weight += item.successful_quantity * model_weight\n    \n    # Step 3: Calculate cost per gram\n    if successful_weight \u003e 0:\n        run.cost_per_gram_actual = total_cost / successful_weight\n        run.successful_weight_grams = successful_weight\n        \n        # Step 4: Calculate per-item costs\n        for item in run.items:\n            item.actual_cost_per_unit = item.model_weight_grams * run.cost_per_gram_actual\n```\n\n**UI - ProductionRunDetail Cost Analysis Card:**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│ 📊 Cost Analysis                                        │\n├─────────────────────────────────────────────────────────┤\n│ Total Material Cost:     £5.00                          │\n│ Successful Weight:       200g (theoretical)             │\n│ Actual Used:             250g                           │\n│ Waste Absorbed:          50g (25%)                      │\n│ Actual Cost/Gram:        £0.025                         │\n│                                                         │\n│ Per-Item Breakdown:                                     │\n│ ┌─────────────────────────────────────────────────────┐ │\n│ │ Model          │ OK  │ Weight │ Cost/Unit │  Total  │ │\n│ ├─────────────────────────────────────────────────────┤ │\n│ │ Dragon Body    │  4  │  20g   │   £0.50   │  £2.00  │ │\n│ │ Dragon Wing    │ 10  │  10g   │   £0.25   │  £2.50  │ │\n│ │ FAILED         │  2  │  -     │   -       │  £0.50  │ │\n│ └─────────────────────────────────────────────────────┘ │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n\n### Phase 2: Model-Level Cost Tracking (Rolling Average)\n\n**Data Model Changes:**\n\n```python\n# Model - add fields:\nactual_production_cost = Column(Numeric(10, 4))  # Rolling average\nproduction_cost_count = Column(Integer, default=0)  # Sample count\nlast_production_cost_at = Column(DateTime)  # Last update\n```\n\n**Update on Run Completion:**\n\n```python\ndef update_model_cost_average(model: Model, new_cost: Decimal, quantity: int):\n    if model.production_cost_count == 0:\n        model.actual_production_cost = new_cost\n        model.production_cost_count = quantity\n    else:\n        # Weighted rolling average\n        total_weight = model.production_cost_count + quantity\n        model.actual_production_cost = (\n            (model.actual_production_cost * model.production_cost_count) +\n            (new_cost * quantity)\n        ) / total_weight\n        model.production_cost_count = total_weight\n    model.last_production_cost_at = datetime.utcnow()\n```\n\n**UI - Model Detail Page:**\n\n```\nCost Information:\n- Theoretical Cost: £0.45 (from BOM)\n- Actual Production Cost: £0.52 (from 47 production runs)\n- Variance: +15.6% (waste/failures factor)\n```\n\n---\n\n### Phase 3: Product-Level Cost Integration\n\n**Computed Property on Product:**\n\n```python\n@property\ndef actual_make_cost(self) -\u003e Optional[Decimal]:\n    \"\"\"Calculate actual make cost from production data.\"\"\"\n    total = Decimal(\"0\")\n    has_data = False\n    \n    for pm in self.product_models:\n        if pm.model.actual_production_cost:\n            total += pm.model.actual_production_cost * pm.quantity\n            has_data = True\n        else:\n            # Fall back to theoretical if no production data\n            total += pm.model.calculate_cost() * pm.quantity\n    \n    return total if has_data else None\n```\n\n**UI - Product Detail Page:**\n\n```\nCost Summary:\n- Theoretical Make Cost: £3.50 (from BOM)\n- Actual Make Cost: £4.12 (from production)\n- Variance: +17.7%\n\nTip: Actual cost includes waste, failures, and material overhead.\n     Run more production to improve accuracy.\n```\n\n---\n\n### Multi-Plate Run Handling\n\nFor runs using `ProductionRunPlate`:\n\n```python\ndef calculate_plate_costs(run: ProductionRun):\n    # Get total cost from all materials\n    total_cost = run.total_material_cost\n    \n    # Calculate total successful weight from plates\n    successful_weight = Decimal(\"0\")\n    for plate in run.plates:\n        model_weight = sum(m.weight_grams for m in plate.model.materials)\n        plate.model_weight_grams = model_weight\n        successful_weight += plate.successful_quantity * model_weight\n    \n    # Calculate cost per gram\n    if successful_weight \u003e 0:\n        run.cost_per_gram_actual = total_cost / successful_weight\n        \n        # Per-plate costs\n        for plate in run.plates:\n            plate.actual_cost_per_unit = plate.model_weight_grams * run.cost_per_gram_actual\n```\n\n---\n\n## Workflow (User Perspective)\n\n### Creating a Product Run\n\n1. **Select Product** (e.g., \"Make 5× Red Squirrel Sets\")\n2. System auto-expands into required plates:\n   - Plate 1: Squirrel Body × 5\n   - Plate 2: Squirrel Tail × 5\n   - Plate 3: Acorn × 10\n3. User can adjust/add/remove plates\n4. Run proceeds through normal workflow\n\n### Completing a Run\n\n1. Enter actual spool weights (existing)\n2. Mark successes/failures per plate (existing)\n3. System calculates:\n   - cost_per_gram_actual\n   - Per-item actual costs\n   - Updates model rolling averages\n4. UI shows cost analysis with variance\n\n### Viewing Costs\n\n**Production Run → Cost Analysis card**\n- Total cost, waste absorbed, per-item breakdown\n\n**Model → Cost Information section**  \n- Theoretical vs Actual, sample count\n\n**Product → Cost Summary section**\n- Theoretical vs Actual make cost\n\n---\n\n## Files to Modify\n\n### Backend\n- `app/models/production_run.py` - Add fields, calculation methods\n- `app/models/model.py` - Add actual_production_cost fields\n- `app/services/production_run_service.py` - Add cost calculation on completion\n- `app/routers/production_runs.py` - Include new fields in responses\n- Migration for new fields\n\n### Frontend\n- `ProductionRunDetail.tsx` - Add Cost Analysis card\n- `ModelDetail.tsx` - Add cost comparison section\n- `ProductDetail.tsx` - Add actual vs theoretical cost\n- API types updates\n\n---\n\n## Key Benefits\n\n1. **Simple**: One formula, automatic waste distribution\n2. **Fair**: Weight-proportional allocation\n3. **Accurate**: Based on real production data\n4. **Progressive**: More runs = better data\n5. **Insightful**: Clear theoretical vs actual comparison\n6. **Actionable**: Identifies high-waste products/models\n\n---\n\n## Research Sources\n\nBased on industry best practices from:\n- SimplyPrint print farm cost tracking\n- 3DPrinterOS billing management\n- PrintFarmHQ COGS calculation\n- Batch costing methodology\n- Activity-Based Costing principles","notes":"Phase 1 complete (72ad43c): Run-level cost analysis with cost_per_gram_actual calculation and Cost Analysis card in UI. Remaining: Phase 2 (Model→Product rollup), Phase 3 (BOM auto-update)","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-06T14:05:36.303044Z","created_by":"jonathan","updated_at":"2026-01-06T15:05:00.509991Z"}
{"id":"nozzly.app-xg0","title":"Backend ModelFile model and service layer","description":"Create SQLAlchemy ModelFile model with relationship to Model. Implement ModelFileService with: upload_file(), delete_file(), list_files_for_model(), get_primary_file(), update_file_metadata(). Integrate with existing ImageStorage pattern for S3/MinIO/local storage. Add MIME type validation for STL, 3MF, and gcode files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T16:12:06.788695Z","created_by":"jonathan","updated_at":"2026-01-04T16:51:44.107524Z","closed_at":"2026-01-04T16:51:44.107524Z","close_reason":"ModelFile model and ModelFileService created - commit bd530df","dependencies":[{"issue_id":"nozzly.app-xg0","depends_on_id":"nozzly.app-1qd","type":"blocks","created_at":"2026-01-04T16:12:18.153711Z","created_by":"jonathan"}]}
{"id":"nozzly.app-xsc","title":"HIGH: N+1 query problem in print queue service","description":"File: backend/app/services/print_queue_service.py (lines 620-644)\n\n_get_printer_queue_stats() performs query in loop:\n- For each printer: job_count query + calculate_etc query\n- Creates O(n) additional queries\n\nFix: Batch all counts in a single SQL query with GROUP BY.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:33:29.775886Z","created_by":"jonathan","updated_at":"2026-01-01T20:25:51.011883Z","closed_at":"2026-01-01T20:25:51.011883Z","close_reason":"Fixed - batched job counts and ETC queries with GROUP BY, reduced O(2n) to O(3) queries"}
{"id":"nozzly.app-xuu","title":"MEDIUM: Missing nginx security headers","description":"File: frontend/nginx.conf\n\nMissing security headers:\n- Content-Security-Policy\n- X-Frame-Options\n- X-Content-Type-Options\n- Referrer-Policy\n\nFix: Add security headers to nginx configuration.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:34:48.418328Z","created_by":"jonathan","updated_at":"2026-01-01T19:52:15.842738Z","closed_at":"2026-01-01T19:52:15.842738Z","close_reason":"Fixed: Added Referrer-Policy, Permissions-Policy, and Content-Security-Policy headers to nginx.conf"}
{"id":"nozzly.app-xvm","title":"HIGH: ReturnRequest RMA number unique globally instead of per-tenant","description":"File: backend/app/models/return_request.py (lines 82-88)\n\nrma_number has unique=True (global) instead of per-tenant unique.\n\nTenant A and Tenant B could have identical RMA numbers.\n\nFix: Replace with UniqueConstraint('tenant_id', 'rma_number', name='uq_return_rma_number_tenant').","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T17:34:12.690139Z","created_by":"jonathan","updated_at":"2026-01-01T19:47:51.250197Z","closed_at":"2026-01-01T19:47:51.250197Z","close_reason":"Fixed: Changed RMA unique constraint from global to per-tenant (tenant_id + rma_number). Created migration."}
{"id":"nozzly.app-zsa","title":"Platform admin API endpoints for module management","description":"Create /api/v1/platform/tenants/{id}/modules endpoints: GET to list tenant modules with status, PUT to enable/disable specific module, POST /reset-defaults to reset tenant to default module config. Require platform_admin role.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T14:37:32.150942Z","created_by":"jonathan","updated_at":"2026-01-04T14:37:32.150942Z","dependencies":[{"issue_id":"nozzly.app-zsa","depends_on_id":"nozzly.app-p4w","type":"blocks","created_at":"2026-01-04T14:37:45.918263Z","created_by":"jonathan"}]}
